<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>My GitHub Thoughts</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body class="bg-gray-50 text-gray-800 font-sans p-6">
  <div class="max-w-4xl mx-auto">
    <h1 class="text-4xl font-bold mb-4 flex items-center gap-2">
      üß† <span>My GitHub Thoughts</span>
    </h1>

    <!-- Tag Filter -->
    <div class="mb-6">
      <label for="tagFilter" class="block mb-2 font-semibold">Filter by Tag:</label>
      <select id="tagFilter" class="p-2 border rounded w-full">
        <option value="">All</option>
      </select>
    </div>

    <div id="posts" class="space-y-8"></div>
  </div>

  <script>
    async function loadPosts() {
      const res = await fetch('data.json');
      const data = await res.json();

      const tagSet = new Set();
      const container = document.getElementById('posts');
      const filter = document.getElementById('tagFilter');

      // ÂàùÂßãÂåñ tag Á≠õÈÄâÂô®
      data.forEach(post => {
        (post.tags || []).forEach(t => tagSet.add(t));
      });
      [...tagSet].sort().forEach(tag => {
        const option = document.createElement('option');
        option.value = tag;
        option.textContent = tag;
        filter.appendChild(option);
      });

      function renderPosts(filteredData) {
        container.innerHTML = '';
        filteredData.forEach(post => {
          const div = document.createElement('div');
          div.className = 'border-b pb-6';

          const html = marked.parse(post.body || '');

          div.innerHTML = `
            <h2 class="text-2xl font-semibold mb-2">
              <a href="${post.html_url}" target="_blank" class="text-blue-600 hover:underline">${post.title}</a>
            </h2>
            <div class="prose prose-sm max-w-none">${html}</div>
            <div class="text-sm text-gray-500 mt-2">üïí ${new Date(post.created_at).toLocaleString()}</div>
            <div class="mt-1 text-xs text-gray-400">${(post.tags || []).join(', ')}</div>
          `;

          // ÂµåÂÖ•ËßÜÈ¢ëÔºöÊîØÊåÅ YouTube ÈìæÊé•Ëá™Âä® iframe
          div.querySelectorAll('a[href*="youtube.com/watch"]').forEach(link => {
            const url = new URL(link.href);
            const videoId = url.searchParams.get('v');
            if (videoId) {
              const iframe = document.createElement('iframe');
              iframe.src = `https://www.youtube.com/embed/${videoId}`;
              iframe.width = "100%";
              iframe.height = "315";
              iframe.className = "mt-4 rounded";
              iframe.allow = "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture";
              iframe.allowFullscreen = true;
              link.replaceWith(iframe);
            }
          });

          // ÂõæÁâáÁîªÂªäÂ§ÑÁêÜÔºà‰ªÖÈôêÂ§öÂº†ÂõæÁâáÂú∫ÊôØÔºâ
          const imgs = div.querySelectorAll('img');
          if (imgs.length > 1) {
            const gallery = document.createElement('div');
            gallery.className = "grid grid-cols-2 md:grid-cols-3 gap-2 mt-4";
            imgs.forEach(img => {
              img.className = "w-full rounded shadow";
              gallery.appendChild(img.cloneNode(true));
              img.remove();
            });
            div.querySelector('.prose').appendChild(gallery);
          }

          container.appendChild(div);
        });
      }

      renderPosts(data);

      // Á≠õÈÄâÈÄªËæë
      filter.addEventListener('change', () => {
        const tag = filter.value;
        if (!tag) return renderPosts(data);
        const filtered = data.filter(post => (post.tags || []).includes(tag));
        renderPosts(filtered);
      });
    }

    loadPosts().catch(err => {
      document.getElementById('posts').innerHTML =
        `<div class="text-red-600">‚ö†Ô∏è Failed to load data.json: ${err.message}</div>`;
    });
  </script>
</body>
</html>
