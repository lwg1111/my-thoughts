<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>My GitHub Thoughts</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body class="bg-gray-50 text-gray-800 font-sans p-6">
  <div class="max-w-3xl mx-auto">
    <h1 class="text-4xl font-bold mb-6 flex items-center gap-2">
      üß† <span>My GitHub Thoughts</span>
    </h1>

    <!-- ÊêúÁ¥¢Ê°Ü -->
    <input id="search" type="text" placeholder="ÊêúÁ¥¢ÂÖ≥ÈîÆËØç..." class="w-full p-3 mb-4 border rounded">

    <!-- Ê†áÁ≠æÁ≠õÈÄâ -->
    <select id="tagFilter" class="mb-6 p-2 border rounded">
      <option value="all">ÊâÄÊúâÊ†áÁ≠æ</option>
    </select>

    <div id="posts" class="space-y-6"></div>

    <!-- ÂàÜÈ°µ -->
    <div id="pagination" class="mt-8 flex justify-center items-center gap-6 text-blue-600 font-medium"></div>
  </div>

  <script>
    const POSTS_PER_PAGE = 5;
    let posts = [], filtered = [], currentPage = 1;

    function renderPosts() {
      const container = document.getElementById('posts');
      container.innerHTML = '';
      const start = (currentPage - 1) * POSTS_PER_PAGE;
      const pagePosts = filtered.slice(start, start + POSTS_PER_PAGE);

      for (const post of pagePosts) {
        const div = document.createElement('div');
        div.className = 'border-b pb-4';
        const html = marked.parse(post.body || '')
          .replace(/<img /g, '<img class="rounded shadow max-w-full cursor-pointer hover:opacity-90" ')  // ÂõæÁâáÊ†∑Âºè
          .replace(/https:\/\/www\.youtube\.com\/watch\?v=([\w-]+)/g, '<iframe class="my-4 w-full aspect-video" src="https://www.youtube.com/embed/$1" frameborder="0" allowfullscreen></iframe>');

        div.innerHTML = `
          <h2 class="text-2xl font-semibold text-blue-600 hover:underline mb-2">
            <a href="${post.html_url}" target="_blank">${post.title}</a>
          </h2>
          <div class="prose prose-gray max-w-none mb-2">${html}</div>
          <div class="text-sm text-gray-500">üïí ${new Date(post.created_at).toLocaleString()}</div>
          <div class="mt-1 text-xs text-gray-400">${(post.tags || []).join(', ')}</div>
        `;
        container.appendChild(div);
      }

      // pagination
      const totalPages = Math.ceil(filtered.length / POSTS_PER_PAGE);
      const p = document.getElementById('pagination');
      p.innerHTML = '';
      if (totalPages > 1) {
        if (currentPage > 1) {
          const prev = document.createElement('button');
          prev.innerText = '‰∏ä‰∏ÄÈ°µ';
          prev.onclick = () => { currentPage--; renderPosts(); };
          p.appendChild(prev);
        }
        if (currentPage < totalPages) {
          const next = document.createElement('button');
          next.innerText = '‰∏ã‰∏ÄÈ°µ';
          next.onclick = () => { currentPage++; renderPosts(); };
          p.appendChild(next);
        }
      }
    }

    function applyFilters() {
      const search = document.getElementById('search').value.toLowerCase();
      const tag = document.getElementById('tagFilter').value;
      filtered = posts.filter(p => {
        const inTag = tag === 'all' || (p.tags || []).includes(tag);
        const inSearch = p.title.toLowerCase().includes(search) || (p.body || '').toLowerCase().includes(search);
        return inTag && inSearch;
      });
      currentPage = 1;
      renderPosts();
    }

    async function loadPosts() {
      try {
        const res = await fetch('data.json');
        posts = await res.json();

        // ÁîüÊàêÊ†áÁ≠æÂàóË°®
        const tagSet = new Set();
        posts.forEach(p => (p.tags || []).forEach(t => tagSet.add(t)));
        for (const tag of tagSet) {
          const opt = document.createElement('option');
          opt.value = tag;
          opt.innerText = tag;
          document.getElementById('tagFilter').appendChild(opt);
        }

        document.getElementById('search').addEventListener('input', applyFilters);
        document.getElementById('tagFilter').addEventListener('change', applyFilters);

        applyFilters();
      } catch (e) {
        document.getElementById('posts').innerHTML = `<div class="text-red-600">‚ö†Ô∏è Failed to load data.json: ${e.message}</div>`;
      }
    }

    loadPosts();
  </script>
</body>
</html>

